\input{data/preamble}

% man spricht ihn Oler Tahng er [http://ole.tange.dk/personen/resume.html]

% git://git.savannah.gnu.org/parallel.git
\begin{document}
\section{Motivation}
% \SidebarCite{book:javase15-std}
\SidebarCite{parallel-tool}
\begin{frame}[c]{Motivation}
% FELIX&FLO
\centering
\onslide<2->{Doing stuff parallel.}\hskip3cm\null\medskip\par
\null\hskip3cm\onslide<3->{With the commandline!}
\end{frame}
\SidebarReset
\section{Background}
\makeatletter % faulheit!
\SidebarRaw{Chapter D-108}
\begin{frame}[c]{Pipes\rhead{Unix Pipelines}}
\centering
% \begin{layout-imageonly}
\begin{tikzpicture}[,codeouthl,every path/.append style={line cap=round,rounded corners=2pt}]
   \onslide<2->{\node[circle,minimum size=1cm,fill] (@) at(0,0) {};}
   \onslide<3->{\draw[{Kite[scale=.8]}-,very thick](@.west) to[edge node={node[above,black] {\textsc{stdin}}}] ++(-2,0) coordinate (@i);}
   \onslide<4->{\draw[-{Kite[scale=.8]},very thick](@.east) to[edge node={node[above,black] {\textsc{stdout}}}] ++(2,0) coordinate (@O);}
   \onslide<5->{\draw[-{Kite[scale=.8]},very thick](@.north) |- ++(2,.5) node[pos=.75,above,black] {\textsc{stderr}};}
   \onslide<6->{\node[below,darkgray] (wc) at(@.south) {\sbfamily\bbash{wc -l}};}
   \only<7->{
   \scope[xshift=-6cm]
   \onslide<7->{\node[circle,minimum size=1cm,fill] (@) at(0,0) {};
   \draw[{Kite[scale=.8]}-,very thick](@.west) to[edge node={node[above,black] {\textsc{stdin}}}] ++(-2,0) coordinate (@I);
   \draw[-{Kite[scale=.8]},very thick](@.east) to[edge node={node[above,black] {\textsc{stdout}}}] ++(2,0)  coordinate (@o);
   \draw[-{Kite[scale=.8]},very thick](@.north) |- ++(2,.5) node[pos=.75,above,black] {\textsc{stderr}};}
   \onslide<8->{\node[below,darkgray] (cat) at(@.south) {\sbfamily\bbash{cat makefile}};}
   \endscope
   }
   \only<9->{
      \pgfinterruptboundingbox
      \draw[-Kite,very thick,codeouthl!70!white] (@o) -- (@i) coordinate[pos=.5] (@@);
      \path (@@|-wc) node[darkgray,xshift=-1mm] {\sbfamily\T{|}};
      \endpgfinterruptboundingbox
   }
   % i don't think, this is needed
   % \only<10->{
   %    \draw[decorate,decoration={brace,mirror,amplitude=2pt},thick,black,sharp corners] ([yshift=-1.25cm]@I) to[edge node={node[below=2pt] {Producer}}] ([yshift=-1.25cm]@o);
   %    \draw[decorate,decoration={brace,mirror,amplitude=2pt},thick,black,sharp corners] ([yshift=-1.25cm]@i) to[edge node={node[below=2pt] {Consumer}}] ([yshift=-1.25cm]@O);
   % }
   % TODO: next slide, connect them with the pipe symbol
   % TODO: make programs black to read them better
\end{tikzpicture}
% \end{layout-imageonly}
% each program run in the command line has three data streams connected to it:
% \begin{tikzpicture}[@O]
% \scope[shift={(current page.south west)},shift={(\beamer@leftmargin,1cm)}]
% \endscope
% \end{tikzpicture}
\end{frame}
\SidebarReset

% TODO: example from: https://www.usenix.org/system/files/login/articles/105438-Tange.pdf
\begin{frame}[c]{Pipes\rhead{II}}
\centering\vspace*{.125em}
\begin{layout-imageonly}
\begin{tikzpicture}[,codeouthl,every path/.append style={line cap=round,rounded corners=2pt}]
   \only<-4|handout:0>{\node[circle,minimum size=1cm,fill] (@) at(0,0) {};
   \pgfinterruptboundingbox
   \draw[-{Kite[scale=.8]},very thick](@.north) |- ++(2,.5) node[pos=.75,above,black] {\textsc{stderr}};
   \endpgfinterruptboundingbox
   }
   \only<5->{
      \pgfinterruptboundingbox
      \node[rectangle,minimum width=3cm,minimum height=2cm,very thick,draw] (@) at(0,0) {};
      \draw[-{Kite[scale=.8]},very thick](@.north) |- ++(2,.5) node[pos=.75,above,black] {\textsc{stderr}};
      \endpgfinterruptboundingbox
   }
   \onslide<6->{
      \node[circle,minimum size=1cm,fill] (@sub) at(0,0) {};
      \draw[{Kite[scale=.8]}-,very thick,line cap=rect](@sub.west) -- ++(-1cm+.1mm,0) coordinate (@i);
      \draw[-{Kite[scale=.8]},very thick](@sub.east) -- ++(1,0) coordinate (@O);
      \draw[-{Kite[scale=.8]},very thick](@sub.north) -- ++(0,.5);
      \node[below,darkgray,scale=.8] (wc) at(@sub.south) {\sbfamily\bbash{gzip}};
   }
   % no O1 for xargs: https://www.mankier.com/7/parallel_alternatives#DIFFERENCES_BETWEEN_GNU_Parallel_AND_ALTERNATIVES-DIFFERENCES_BETWEEN_xargs_AND_GNU_Parallel
   \draw[{Kite[scale=.8]}-,very thick](@.west) to[edge node={node[above,black] {\textsc{stdin}}}] ++(-2,0) coordinate (@i);
   \draw[-{Kite[scale=.8]},very thick,line cap=rect](@.east) to[edge node={node[above,black] {\textsc{stdout}}}] ++(2,0) coordinate (@O);
   \onslide<4->{\node[below,darkgray] (wc) at(@.south) {\sbfamily\bbash{xargs gzip}};}
   % NOTE: use --keep! and maybe --recursive for data

   \scope[xshift=-7cm]
   \node[circle,minimum size=1cm,fill] (@) at(0,0) {};
   \draw[{Kite[scale=.8]}-,very thick](@.west) to[edge node={node[above,black] {\textsc{stdin}}}] ++(-2,0) coordinate (@I);
   \draw[-{Kite[scale=.8]},very thick](@.east) to[edge node={node[above,black] {\textsc{stdout}}}] ++(2,0)  coordinate (@o);
   \draw[-{Kite[scale=.8]},very thick](@.north) |- ++(2,.5) node[pos=.75,above,black] {\textsc{stderr}};
   \onslide<2->{\node[below,darkgray] (ls) at(@.south|-wc.north) {\sbfamily\bbash{find . -type f}};}
   \onslide<3->{\node[below=2mm,inner sep=1.5mm,fill=gray!10!white,rounded corners=2pt,text width=3cm,text=black,align=left,font=\ttfamily,scale=.85] at([xshift=1cm]ls.south) {%
      ./Dockerfile\\
      ./run-docker\\
      ./makefile\\
      \vdots
   };}
   % ls hat Probleme, ist hier nur als einfaches Beispiel:
   % https://unix.stackexchange.com/questions/128985/why-not-parse-ls-and-what-to-do-instead
   \endscope
   \draw[-Kite,very thick,codeouthl!70!white] (@o) -- (@i) coordinate[pos=.5] (@@);
   \path (@@|-wc) node[darkgray,xshift=-1mm] {\sbfamily\T{|}};
   % TODO: benchmarks
\end{tikzpicture}
\end{layout-imageonly}
% each program run in the command line has three data streams connected to it:
\end{frame}

\begin{frame}[c]{Pipes\rhead{III}}
   \centering\vspace*{.125em}
\begin{layout-imageonly}
   \begin{tikzpicture}[,codeouthl,every path/.append style={line cap=round,rounded corners=2pt}]
      \onslide<-2|handout:0>{\pgfinterruptboundingbox
      \node[rectangle,minimum width=3cm,minimum height=2cm,very thick,draw] (@) at(0,0) {};
      \endpgfinterruptboundingbox}
      % keeps old @ to avoid jumps
      \onslide<2-|handout:0>{\node[below,darkgray] (wc) at(@.south) {\only<-2|handout:0>{\sbfamily\bbash{parallel gzip}}\only<3->{\phantom{\sbfamily\bbash{parallel gzip}}}};}
      \only<-2|handout:0>{
         \node[circle,minimum size=1cm,fill] (@sub) at(0,0) {};
         \draw[{Kite[scale=.8]}-,very thick,line cap=rect](@sub.west) -- ++(-1cm+.1mm,0) coordinate (@i);
         \draw[-{Kite[scale=.8]},very thick](@sub.east) -- ++(1,0) coordinate (@O);
         \draw[-{Kite[scale=.8]},very thick](@sub.north) -- ++(0,.5);
         \node[below,darkgray,scale=.8] (gz-wc) at(@sub.south) {\sbfamily\bbash{gzip}};
      % TODO: multiples
      }
      \only<3->{
         \pgfinterruptboundingbox
         \node[rectangle,minimum width=3cm,minimum height=5.5cm,very thick,draw] (@) at(0,0) {};
         \endpgfinterruptboundingbox
         \fill (@.west)++(0,.25) arc(90:-90:.25);
         \fill (@.east)++(0,.25) arc(90:270:.25);
         \fill (@.north)++(.25,0) arc(0:-180:.25);

         % hardcode copy-paste love
         \node[circle,minimum size=1cm,fill] (@sub2) at(0,-1.75) {};
         \draw[{Kite[scale=.8]}-,very thick,line cap=rect](@sub2.west) -- ++(-1cm+.1mm+5mm,0) -- ++(-5mm,1.75);
         \draw[-{Kite[scale=.8]},very thick,shorten >=.25cm](@sub2.east) -- ++(1-.5,0) -- ++(.5,1.75);
         \draw[-{Kite[scale=.8]},very thick,codeouthl!60!white,shorten >=.25cm](@sub2.north) to[bend left=8] ++(0,.5+2*1.75);
         \node[below,darkgray,scale=.8] (gz-wc) at(@sub2.south) {\sbfamily\bbash{gzip}};
         \node[circle,minimum size=1cm,fill] (@sub) at(0,0) {};
         \draw[{Kite[scale=.8]}-,very thick,line cap=rect](@sub.west) -- ++(-1cm+.1mm,0) coordinate (@i);
         \draw[-{Kite[scale=.8]},very thick](@sub.east) -- ++(1-.25,0) coordinate (@O);
         \draw[-{Kite[scale=.8]},very thick,codeouthl!60!white,shorten >=.25cm](@sub.north) to[bend right=8] ++(0,.5+1.75);
         \node[below,darkgray,scale=.8] (gz-wc) at(@sub.south) {\sbfamily\bbash{gzip}};
         \node[circle,minimum size=1cm,fill] (@sub1) at(0,1.75) {};
         \draw[{Kite[scale=.8]}-,very thick,line cap=rect](@sub1.west) -- ++(-1cm+.1mm+5mm,0) -- ++(-5mm,-1.75);
         \draw[-{Kite[scale=.8]},very thick,shorten >=.25cm](@sub1.east) -- ++(1-.5,0)  -- ++(.5,-1.75);
         \draw[-{Kite[scale=.8]},very thick](@sub1.north) -- ++(0,.5);
         \node[below,darkgray,scale=.8] (gz-wc) at(@sub1.south) {\sbfamily\bbash{gzip}};
      }
      \draw[{Kite[scale=.8]}-,very thick](@.west) to[edge node={node[above,black] {\textsc{stdin}}}] ++(-2,0) coordinate (@i);
      \draw[-{Kite[scale=.8]},very thick,line cap=rect](@.east) to[edge node={node[above,black] {\textsc{stdout}}}] ++(2,0) coordinate (@O);
      \pgfinterruptboundingbox
      \draw[-{Kite[scale=.8]},very thick](@.north) |- ++(2,.5) node[pos=.75,above,black] {\textsc{stderr}};
      \endpgfinterruptboundingbox

      \onslide<3->{\node[below,darkgray] (pgz) at(@.south) {\sbfamily\bbash{parallel gzip}};}
      % NOTE: use --keep! and maybe --recursive for data

      \scope[xshift=-7cm]
      \node[circle,minimum size=1cm,fill] (@) at(0,0) {};
      \draw[{Kite[scale=.8]}-,very thick](@.west) to[edge node={node[above,black] {\textsc{stdin}}}] ++(-2,0) coordinate (@I);
      \draw[-{Kite[scale=.8]},very thick](@.east) to[edge node={node[above,black] {\textsc{stdout}}}] ++(2,0)  coordinate (@o);
      \draw[-{Kite[scale=.8]},very thick](@.north) |- ++(2,.5) node[pos=.75,above,black] {\textsc{stderr}};
      \node[below,darkgray] (ls) at(@.south|-wc.north) {\sbfamily\bbash{find . -type f}};
      \node[below=2mm,inner sep=1.5mm,fill=gray!10!white,rounded corners=2pt,text width=3cm,text=black,align=left,font=\ttfamily,scale=.85] at([xshift=1cm]ls.south) {%
         ./Dockerfile\\
         ./run-docker\\
         ./makefile\\
         \vdots
      };
      \endscope
      \draw[-Kite,very thick,codeouthl!70!white] (@o) -- (@i) coordinate[pos=.5] (@@);
      \path (@@|-wc) node[darkgray,xshift=-1mm] {\sbfamily\T{|}};

      % TODO: benchmarks
   \end{tikzpicture}
\end{layout-imageonly}
% TODO: übergang pipe animation
% Nicer: https://www.usenix.org/system/files/login/articles/105438-Tange.pdf
\end{frame}
% TODO: nice example clock:
% parallel -k echo {1}'{=3 $_=$_%2?":":" "=}'{2}{3} \
% ::: {0..12} ::: {0..5} ::: {0..9}
% from manual
% TODO: even with grouping, e.g by piping with 'sort' - a stateful operation which operates as "Flaschenhals"
% TODO: auch auf ::: und so eingehen % FLORIAN


\section{GNU \LogoParallel}
\begin{frame}[fragile]{A simple Bank}
\centering\begin{onlyenv}<2-8|handout:1>
\centering\begin{tikzpicture}[codeouthl,xscale=2]
   \scope[K/.style={circle,fill,scale=1.25}]
      {\only<3-4|handout:0>{\color{shadeA}}\node[K] (1) at (0,0) {};
         \onslide<3-4>{\node[gray,below=-.25mm] at(1.south) {\faUser};}
         \onslide<3->{\node[black,above] at(1.north) {Producer};}
      }
      \node[K,codeouthl!60!white] (2) at (1,0) {};
      {\only<5-6|handout:0>{\color{shadeA}}
         \node[K] (3a) at (2,2) {};
         \node[K] (3b) at (2,1) {};
         \node[K] (3c) at (2,0) {};
         \node[K] (3d) at (2,-1) {};
         \node[K] (3e) at (2,-2) {};
         \onslide<5-6>{\foreach \a in {a,b,c,d,e} {\node[gray,below=-.25mm] at(3\a.south) {\faUser};}}
         \onslide<5->{\node[black,above] at(3a.north) {Consumer~1};}
      }
      {\only<7-8|handout:0>{\color{shadeA}}
         \node[K] (4) at (3,0) {};
         \onslide<7->{\node[black,right] (4d) at(4.east) {Consumer~2};}
         \onslide<8->{
            \node[black,below=.5mm,align=left,font=\ttfamily] at(4d.south) {Abby: \kern.8pt-11\\Bert: ~~3\\Carlos: 2\\\vdots};
         }
      }
   \endscope
   \scope[every path/.append style={draw,very thick,-Kite,rounded corners=2pt,line cap=round}]
   \path(1) -- (2) coordinate[pos=.5] (@12);
   \onslide<4->{\node[black,below=.5mm,align=left,font=\ttfamily] at(@12.south) {1 4 3\\1 3 8\\3 2 2\\\vdots};}

   \path[codeouthl!60!white] (2) -- (3c); \path(3c) -- (4);
   \foreach[count=\i]\a in {a,b,d,e} {
      \path[codeouthl!60!white] (2) -- ([xshift=-1.5em]3\a.west) -- (3\a.west);
     \path (3\a.east) -- ++(1.5em,0) coordinate(@) -- (4);
     \onslide<6->{\ifnum\i=1
         \node[black,right=2.75mm,font=\ttfamily,align=left] at(@.east) {\T{Abby -3}\\\T{Bert ~3}\\Abby -8\\\vdots};
      \fi}
   }
   \endscope
\end{tikzpicture}
\end{onlyenv}
\begin{onlyenv}<9-|handout:2->
\begin{tikzpicture}[@O]
\scope[shift={(current page.north east)},shift={(-4cm,-2cm)},codeouthl,xscale=2,K/.style={circle,fill,scale=1.25},scale=.5,every ndoe/.append style={transform shape}]
      {\only<10-13|handout:2>{\color{shadeA}} \node[K] (1) at (0,0) {};}
      \node[K,codeouthl!60!white] (2) at (1,0) {};
      {\only<14-17|handout:3>{\color{shadeA}}
         \node[K] (3a) at (2,2) {};
         \node[K] (3b) at (2,1) {};
         \node[K] (3c) at (2,0) {};
         \node[K] (3d) at (2,-1) {};
         \node[K] (3e) at (2,-2) {};
      }
      {\only<18-20|handout:4>{\color{shadeA}}
         \node[K] (4) at (3,0) {};
      }

      \scope[every path/.append style={draw,very thick,-{Kite[scale=.8]},rounded corners=2pt,line cap=round}]
   \path(1) -- (2) coordinate[pos=.5] (@12);

   \path[codeouthl!60!white] (2) -- (3c); \path(3c) -- (4);
   \foreach[count=\i]\a in {a,b,d,e} {
      \path[codeouthl!60!white] (2) -- ([xshift=-1.5em]3\a.west) -- (3\a.west);
       \path (3\a.east) -- ++(1.5em,0) coordinate(@) -- (4);
   }
   \endscope
\endscope
\end{tikzpicture}
\end{onlyenv}
\begin{onlyenv}<10-|handout:2->
\begin{layout-imageonly}
\begin{onlyenv}<10-13|handout:2>
\begin{tikzpicture}[@O]
   \onslide<11->{\hlbehindcodeunder{n}{@n>}
      \draw[T,-Kite] (@n>_up) to[bend left] ++(.5,.35) node[right] {number of transactions};
   }
   \onslide<12->{\hlbehindcodeunder{names}{@names>}
      \draw[T,-Kite] (@names>_up) to[bend left] ++(.5,.35) node[right] {known account names};
   }

   \onslide<13->{\hlbehindcodeunder{value}{@value>}
      \node[T,below] at (@value>_down) {value};
   }
\end{tikzpicture}
\begin{minted}{java}
/*\CodeFileMarkerUrl{https://github.com/EagleoutIce/ccpdp-lightning-ss22-gnu-parallel/blob/main/example/java-side/src/main/java/de/uulm/ccpdp/lt/ff/Producer.java}{Producer.java}*/
final var rand = new Random();

for (int i = 0; i < /*\Snode{n}*/n/*\Snode{n@}*/; i++) {
   int from = rand.nextInt(/*\Snode{names}*/NAMES/*\Snode{names@}*/.length);
   int to = rand.nextInt(NAMES.length);
   System.out.format("%d %d %d%n", from, to, /*\Snode{value}*/rand.nextInt(100) * 10/*\Snode{value@}*/);
}/*\onslide<1->*/
\end{minted}
% TODO: highlight n as number, names for constants and value
\end{onlyenv}
\begin{onlyenv}<14-17|handout:3>
\begin{tikzpicture}[@O]
   \onslide<15->{
      \hlbehindcodeunder{from}{@from>}
      \draw[T,-Kite] (@from>_up) to[bend left] ++(.5,.35) node[right] {0};
   }
   \onslide<16->{
      \hlbehindcodeunder{to}{@to>}
      \draw[T,-Kite] (@to>_up) to[bend left] ++(.5,.35) node[right] {1};
   }
   \onslide<17->{
      \hlbehindcodeunder{value}{@value>}
      \draw[T,-Kite] (@value>_up) to[bend left] ++(.5,.35) node[right] {2};
   }
\end{tikzpicture}
\begin{minted}{java}
/*\CodeFileMarkerUrl{https://github.com/EagleoutIce/ccpdp-lightning-ss22-gnu-parallel/blob/main/example/java-side/src/main/java/de/uulm/ccpdp/lt/ff/Consumer.java}{Consumer.java}*/
final var scanner = new Scanner(System.in);
while (scanner.hasNextLine()) {
   String[] s = scanner.nextLine().split(" ");/*\vspace{\medskipamount+1mm}*/
   String from = NAMES[Integer.parseInt(s[/*\Snode{from}*/FROM/*\Snode{from@}*/])];
   System.out.printf("%s -%d%n", from, Integer.parseInt(s[/*\Snode{value}*/VALUE/*\Snode{value@}*/]));/*\vspace{\medskipamount+1mm}*/
   String to = NAMES[Integer.parseInt(s[/*\Snode{to}*/TO/*\Snode{to@}*/])];
   System.out.printf("%s %d%n", to, Integer.parseInt(s[VALUE]));
}
scanner.close();/*\onslide<1->*/
\end{minted}
\end{onlyenv}
\begin{onlyenv}<18-20|handout:4>
\begin{tikzpicture}[@O]
   \onslide<19->{
      \hlbehindcodeunder{getOrDefault}{@getOrDefault>}
      \draw[T,-Kite] ([yshift=.125mm]@getOrDefault>_up) to[bend left] ++(.5,.35) node[right] {Arbitrary initialization};
   }
   \onslide<20->{
      \hlbehindcodeunder{accounts}{@accounts>}
      \draw[T,-Kite] (@accounts>_up) to[bend left] ++(.5,.35) node[right] {\T{AbstractMap.toString()}};
   }
\end{tikzpicture}
\begin{minted}{java}
/*\CodeFileMarkerUrl{https://github.com/EagleoutIce/ccpdp-lightning-ss22-gnu-parallel/blob/main/example/java-side/src/main/java/de/uulm/ccpdp/lt/ff/Accountant.java}{Accountant.java}*/
final var scanner = new Scanner(System.in);
final var accounts = new HashMap<String, Integer>();
while (scanner.hasNextLine()) {
   String[] trans = scanner.nextLine().split(" ");

   final var old = accounts./*\Snode{getOrDefault}*/getOrDefault(trans[0], 0)/*\Snode{getOrDefault@}*/;
   accounts.put(trans[0], old + Integer.parseInt(trans[1]));
}
scanner.close();
System.out.println(/*\Snode{accounts}*/accounts/*\Snode{accounts@}*/);/*\onslide<1->*/
\end{minted}
\end{onlyenv}
\end{layout-imageonly}
\end{onlyenv}
\end{frame}

% \subsection{The Running-Example}
{
\lstset{add to literate={\\}{{{\color{codeouthl}{\textbackslash}}}}1}
\def\K#1{\begin{colormixin}{30!black}#1\end{colormixin}}% i dunno, semes to look nice
\newcommand<>\M{\only#1{\color{gray}}}
\newcommand<>\MM[1]{\colorlet{@mixn}{black}\only#2{\colorlet{@mixn}{gray}}\begin{colormixin}{0!@mixn}#1\end{colormixin}}% i dunno, semes to look nice
\def\Q{\only<7->}
\def\Y{\only<12->}
\begin{frame}[fragile,t]{Running the Example} % top for second table?
\centering\vspace*{2em}% top buffer
\SetupLstHl
\begin{onlyenv}<2-8|handout:1>
\begin{minted}{bash}
/*\onslide<3->*/java -jar producer.jar 1000000/*\onslide<4->*/\
	| java -jar consumer.jar/*\onslide<5->*/\
	| java -jar accountant.jar/*\onslide<1->*/
\end{minted}
\end{onlyenv}
% TODO: did it in a makefile so that we see this statement as well (otherwise the host shell would do that)
% ❯ make run-no-parallel& ; sleep 1; ps -o pid,ppid,cpuid,cmd > run.data
% ❯ make run& ; sleep 1; ps -o pid,ppid,cpuid,cmd > run2.data
% C is lastcpu | cpuid
% lwp light weight process (thread)
% PSR is currently assigned processor
% ps -F
\begin{onlyenv}<9|handout:0>
\begin{minted}{bash}
&ihl&java -jar producer.jar 1000000\&ihl&
&ihl&	| java -jar consumer.jar&ihl&
&ihl&	| java -jar accountant.jar&ihl&/*\onslide<1->*/
\end{minted}
\end{onlyenv}
\begin{onlyenv}<10-|handout:2>
\begin{minted}{bash}
&ihl&java -jar producer.jar 1000000\&ihl&
&ihl&	| &ihl&parallel --pipe &ihl&java -jar consumer.jar\&ihl&
&ihl&	| java -jar accountant.jar&ihl&/*\onslide<1->*/
\end{minted}
% TODO: different colors? for ppid -> pid
% TODO: auf gleiche ids hinweise
\end{onlyenv}
\begin{tikzpicture}[@O,outer sep=0pt,inner sep=0pt]
\onslide<11-|handout:2>{\node[above right,xshift=\beamer@leftmargin,yshift=1cm,font=\tiny\ttfamily,text width=14cm] (@) at(current page.south west) {\begin{tabular}{rrrl}
      {pid} & {ppid} & {cpuid} & {cmd} \\ % {lwp} & \rlap{\quad\ldots}
\midrule
  38279 & \M<13->38276 &  \M<13->3 & \MM<13->{\bbash{/bin/bash -c java -jar producer.jar 1000000 | parallel --pipe java -jar consumer.jar | java -jar a:ldots:}}\kern-3pt\\
  \Y{\M<13->38280} & \Y{38279} &  \Y{6} & \Y{\K{\bbash{java -jar producer.jar 1000000}}} \\
  \Y{38281} & \Y{38279} & \Y{15} & \Y{\K{\bbash{perl /usr/bin/parallel --pipe java -jar consumer.jar}}} \\
  \Y{\M<13->38282} & \Y{38279} &  \Y{5} & \Y{\K{\bbash{java -jar accountant.jar}}} \\ % \smallskip\\
  \Y{38344} & \Y{38281} & \Y{10} & \Y{\K{\bbash{perl -e if(sysread(STDIN,\$buf,1))\{open(\$fh }}\textcolor{gray}{\,[\ldots]\!}\K{\bbash{\} /usr/bin/bash -c java -jar consumer.jar}}} \\
  \Y{\M<13->38345} & \Y{38281} &   \Y{\M<13->4} & \MM<13->{\Y{\K{\bbash{perl -e if(sysread(STDIN,\$buf,1))\{open(\$fh }}\textcolor{gray}{\,[\ldots]\!}\K{\bbash{\} /usr/bin/bash -c java -jar consumer.jar}}}} \\
  \Q{\color{gray}\ldots} & \Q{\color{gray}\ldots} & \Q{\color{gray}\ldots} & \Q{\color{gray}\ldots} \\
  \Y{\M<13->38363} & \Y{38281} &  \Y{\M<13->10} & \MM<13->{\Y{\K{\bbash{perl -e if(sysread(STDIN,\$buf,1))\{open(\$fh }}\textcolor{gray}{\,[\ldots]\!}\K{\bbash{\} /usr/bin/bash -c java -jar consumer.jar}}}} \\
  \Y{\M<13->38383}  & \Y{38281} &   \Y{\M<13->4} & \Y{\MM<13->{\bbash{perl /usr/bin/parallel --pipe java -jar consumer.jar}}} \\
  \Y{\M<13->38384}  & \Y{38344} &  \Y{2} & \Y{\K{\bbash{java -jar consumer.jar}}} \\
  \Y{\M<13->38438}  & \Y{\M<13->38136} &  \Y{\M<13->12} & \Y{\MM<13->{\bbash{ps -o pid,ppid,cpuid,cmd}}}
   \end{tabular}};}

   % below right for same position! so it does not jump
   \onslide<6-10|handout:1>{\node[below right,font=\tiny\ttfamily,text width=14cm] (@2) at(@.north west) {\begin{tabular}{rrrl}
         {pid} & {ppid} & {cpuid} & {cmd} \\ % {lwp} & \rlap{\quad\ldots}
   \midrule
   25621 & \M<8->25618 &  \M<8->7 &\rlap{\MM<8->{\bbash{/bin/bash -c java -jar producer.jar 1000000 | java -jar consumer.jar | java -jar accountant.jar}}}% align lap:
   \phantom{\bbash{/bin/bash -c java -jar producer.jar 1000000 | parallel --pipe java -jar consumer.jar | java -jar a:ldots:}\kern-3pt}\\
   \Q{\M<8->25622} & \Q{25621}  &  \Q{2} & \Q{\K{\bbash{java -jar producer.jar 1000000}}} \\
   \Q{\M<8->25623} & \Q{25621}  &  \Q{ 14} & \Q{\K{\bbash{java -jar consumer.jar}}} \\
   \Q{\M<8->25624} & \Q{25621}  &  \Q{ 13} & \Q{\K{\bbash{java -jar accountant.jar}}} \\
   \Q{\M<8->25738} & \Q{\M<8->5113} &  \Q{\M<8->9} & \Q{\MM<8->{\bbash{ps -o pid,ppid,cpuid,cmd}}}
      \end{tabular}};
   }
   \only<0|handout:1>{% TODO: make comment in presentation manually?
      % tikzmark is problematic due to nested tikz and me being lzy
      \draw[-Kite,T] ([xshift=1.5cm,yshift=-.75cm]@2.north) to[bend right] ++(.4,-.4) node[below right,xshift=.5ex,align=left,yshift=.25\baselineskip] {Ran from within a makefile\\(directly done by shell otherwise)};
      \draw[-Kite,T] ([xshift=-2.5cm,yshift=-1.75cm]@2.north) to[bend right] ++(.4,-.4) node[below right,xshift=.5ex,align=left,yshift=.25\baselineskip] {Produces (a superset of) this table};
   }
   \only<0|handout:2>{%
      % tikzmark is problematic due to nested tikz and me being lzy
      \draw[-Kite,T] ([xshift=-.75cm,yshift=-2.65cm]@2.north) to[out=270,in=185] ++(.65,-.125) node[below right,xshift=.5ex,align=left,yshift=.2\baselineskip,scale=.8] {Used for generic splitting magic\\(e.g., not done with \bbash{--roundrobin})};
   }
\end{tikzpicture}
% TODO: show roundrobin much simpler only java-jar etc-
%    grafik und Code
% wann sinnvoll usw.
% bank beispiel mit java  %  FELIX
\begin{tikzpicture}[@O]
\scope[shift={(current page.north east)},shift={(-4cm,-2cm)},codeouthl,xscale=2,K/.style={circle,fill,scale=1.25},scale=.5,every ndoe/.append style={transform shape}]
      \only<2-9|handout:1>{{\only<3|handout:0>{\color{shadeA}}\node[K] (1) at (0,0) {};}
      {\only<4|handout:0>{\color{shadeA}}\node[K] (2) at (1,0) {};}
      {\only<5|handout:0>{\color{shadeA}}\node[K] (3c) at (2,0) {};}

      \scope[every path/.append style={draw,very thick,-{Kite[scale=.8]},rounded corners=2pt,line cap=round}]
        \path(1) -- (2) coordinate[pos=.5] (@12);
        \path (2) -- (3c);
   \endscope}
   \only<10-|handout:2>{
      \node[K] (1) at (0,0) {};
      \node[K,codeouthl!60!white] (2) at (1,0) {};
      \node[K] (3a) at (2,2) {};
      \node[K] (3b) at (2,1) {};
      \node[K] (3c) at (2,0) {};
      \node[K] (3d) at (2,-1) {};
      \node[K] (3e) at (2,-2) {};
      \node[K] (4) at (3,0) {};

      \scope[every path/.append style={draw,very thick,-{Kite[scale=.8]},rounded corners=2pt,line cap=round}]
   \path(1) -- (2) coordinate[pos=.5] (@12);

   \path[codeouthl!60!white] (2) -- (3c); \path(3c) -- (4);
   \foreach[count=\i]\a in {a,b,d,e} {
      \path[codeouthl!60!white] (2) -- ([xshift=-1.5em]3\a.west) -- (3\a.west);
       \path (3\a.east) -- ++(1.5em,0) coordinate(@) -- (4);
   }
   \endscope
   }
\endscope
\end{tikzpicture}
% TODO: somewhat like a sleepy consumer 1? so that we can see, how parallel does work
\end{frame}
}

\subsection{History}
\SidebarCite{Tange2011a}
\SidebarCite{gnuHistoryParallel}
\begin{frame}{History}
   \begin{itemize}[<+(1)->]
      \itemsep10pt
      \item Originally two tools: xxargs and \LogoParallel. \begin{itemize}
         \itemsep5pt
         \item Parallel was originally a wrapper that generated a makefile and used \bbash{make -j} to do the parallelization
         \item xxargs and \LogoParallel got merged into parallel
         \item Two objectives: \begin{itemize}
            \item replace xargs % whitespace problems
            \item run commands in parallel
         \end{itemize}
      \end{itemize}
      \item In 2010, \LogoParallel was adopted as an official GNU tool, named GNU \LogoParallel.
   \end{itemize}
   % Single-file to work easily, perl because seems to be widespread, problem: overhead (--tag option+, https://www.gnu.org/software/parallel/parallel_design.pdf)
\end{frame}
\SidebarReset

\subsection{Distribution}
{
\lstset{add to literate={\$SERVER}{{{\color{gray}\textdollar SERVER}}}7 {\$SECRET_PW}{{{\color{gray}\textdollar SECRET\textunderscore PW}}}9 {\$SERVER1}{{{\color{gray}\textdollar SERVER1}}}7 {\\}{{{\color{codeouthl}{\textbackslash}}}}1}
\SidebarRaw{\link{https://www.gnu.org/software/parallel/parallel\_tutorial.html\#transferring-files}{{\faExternalLink}~parallel tutorial~[06/30/22]}}
\begin{frame}[fragile]{Distributed}
\begin{itemize}[<+(1)->]
   \itemsep6pt
   % \item \flo{Felix wo hast du die Beispiele her? Quellen!}
   \item GNU \LogoParallel can run jobs on remote servers \begin{itemize}
      \item It uses ssh to communicate with the remote machines\pause
      \begin{minted}{bash}
parallel -S $SERVER echo running on ::: $SERVER/*\onslide<1->*/
      \end{minted}
   \end{itemize}
   \item Transfer Files using rsync:
\begin{itemize}
   \item Long version:
   \begin{minted}[deletekeywords={transferfile}]{bash}
parallel -S 1/"sshpass -p '$SECRET_PW' /*\solGet{literals}{ssh}*//*\solGet{literals}{\textvisiblespace}*//*\solGet{literals}{limerent@localhost}*/" /*\T{-{}-transferfile}*/ {}\
   /*\T{-{}-return}*/ {}./*\T{gz}*/ /*\T{-{}-cleanup}*/ gzip ::: README.txt/*\onslide<1->*/
   \end{minted}
   \item Shorthands like \T{-trc} (transferfile, return, cleanup)
\end{itemize}
% \item TODO: beautiful shortant
\end{itemize}
   % erweiterungen wei verteilt mehrere Systeme % FELIX (-ssh oder so)
\end{frame}
\SidebarReset

\SidebarRaw{\link{https://www.gnu.org/software/parallel/parallel\_tutorial.html\#avoid-overloading-sshd}{{\faExternalLink}~parallel tutorial~[06/30/22]}}
\begin{frame}[fragile]{Useful Flags}
\begin{itemize}[<+(1)->]
   \itemsep12pt
   \item Prevent \T{sshd} overloading:\pause
\begin{minted}{bash}
parallel -S $SERVER /*\T{-}*//*\T{-}*//*\T{sshdelay}*/ 0.2 echo ::: 1 2 3/*\onslide<1->*/
\end{minted}
   \item Multiplex connections with \bbash{--controlmaster}
   \item Transfer Files using rsync: \begin{itemize}
      \item \bbash{--basefile}, copy this file to each sshlogin % note: --cleanup
      \item \bbash{--workdir}, change from login directory
      \item \bbash{--onall}, run job on all sshlogins % only mention: /\bbash{--nonall},
      % \item \bbash{--tag} not just for sshlogin
   \end{itemize}
\end{itemize}
% grafik und Code
\end{frame}
\SidebarReset

\subsection{Other Languages}
\SidebarRaw{Chapter E-30--32}
\begin{frame}[fragile]{Other Languages}
   %Grafik und Code
   % NOTE: bitte callbacks, arrow stile und so erwähnen.
   % ich nutze von create iterface nicht auch noch output und write,
   % da das sonst aus ieinem Grund nicht läuft^^
\begin{layout-imageonly}% we don't really need ts here ^^
\begin{tikzpicture}[@O]
   \onslide<3->{\hlbehindcodeunder{in}{@in>}
      \draw[T,-Kite] (@in>_up) to[bend left] ++(.5,.35) node[right] {Read from \textsc{stdin}};
   }
   \onslide<4->{\hlbehindcodeunder{lazy}{@lazy>}
      \draw[T,-Kite] ([yshift=-.125mm]@lazy>_down) to[bend right] ++(.5,-.35) node[right] {Use 0 as initial value};
      % TODO: if value is not falsy: 'false, 0, 0n, '', null, undefined, NaN' <- none of which we care for in this case (just shorter)
      % => we are "faul/lazy" (not lazy evaluation ^^ lazy programmer)
   }

   \onslide<5->{\hlbehindcodeunder{cb1}{@cb1>}
      \draw[T,-Kite] (@cb1>_up) to[bend left] ++(.5,.35) node[right] {Register callback for 'line' event};
   }
   \onslide<6->{\hlbehindcodeunder{cb2}{@cb2>}
      \draw[T,-Kite] ([yshift=-.125mm]@cb2>_down) to[bend right] ++(.5,-.35) node[right] (@) {Anonymous callback for 'closed' event};
      \node[T,below right,yshift=1mm] at(@.south west) {(arrow style)};
   }
\end{tikzpicture}\vspace*{-1.33\baselineskip} % some padding for the consumer.ts line
   \begin{minted}[morekeywords={[2]{string,Map}},morekeywords={[3]{console,process}}]{javascript}
/*\onslide<2->*//*\CodeFileMarkerUrl{https://github.com/EagleoutIce/ccpdp-lightning-ss22-gnu-parallel/blob/main/example\%20object\%20and\%20js/consumer.ts}{consumer.ts}*/
const accMap = new Map<string, number>();
const rl = createInterface({ input: /*\Snode{in}*/process.stdin/*\Snode{in@}*/ });

function handleLine(input: string): void {
  const s = input.split(" ");
  accMap.set(s[0], /*\Snode{lazy}*/accMap.get(s[0]) ?? 0/*\Snode{lazy@}*/ + Number(s[1]));
}

rl.on("line", /*\Snode{cb1}*/handleLine/*\Snode{cb1@}*/);
rl.on("close", /*\Snode{cb2}*/() => console.log(accMap)/*\Snode{cb2@}*/);/*\onslide<1->*/
   \end{minted}
\end{layout-imageonly}
   % verschiedene Sprache % FELIX
   % TODO: timeout option?
\end{frame}
\SidebarReset

{

\lstset{add to literate={\\}{{{\color{codeouthl}{\textbackslash}}}}1}
\def\K#1{\begin{colormixin}{30!black}#1\end{colormixin}}% i dunno, semes to look nice
\newcommand\M{\only<9->{\color{gray}}}
\newcommand\MM[1]{\colorlet{@mixn}{black}\only<9->{\colorlet{@mixn}{gray}}\begin{colormixin}{0!@mixn}#1\end{colormixin}}% i dunno, semes to look nice
\def\Q{\only<8->}
\begin{frame}[fragile,t]{Integrating TypeScript}
\begin{layout-imageonly}[t]
   \begin{minted}{bash}
/*\onslide<2->*/java -jar producer.jar 1000000\
   | parallel --pipe /*\tikzmarknode{roundrobin}{\T{-{}-roundrobin}}*/ /*\tikzmarknode{jobs}{\T{-j\solGet{numbers}{4}}}*/ java -jar consumer.jar\
   | /*\Snode{yarn}*/yarn --silent start/*\Snode{yarn@}*//*\onslide<1->*/
   \end{minted}
% See also --use-cores-instead-of-threads and --use-sockets-instead-of-threads.
\end{layout-imageonly}
   % todo node yarn only runs tsc and node
\begin{tikzpicture}[@O]
   \onslide<3->{\draw[T,-Kite] ([yshift=-.25mm]jobs.-40) to[bend right] ++(.5,-.33) node[right] {\T{-{}-jobs 4}};}
   \onslide<4->{
      \draw[T,-Kite] ([yshift=1pt,xshift=-1pt]roundrobin.6) to[out=80,in=260] ++(.66,.85) node[above right,xshift=-1.2ex,yshift=-.325mm] (@n) {Distributes \setbox0=\hbox{records}\kern.5\wd0\clap{\copy0}\clap{\raisebox{\baselineskip}{\scriptsize\only<5->{\T{-{}-recend ''\textbackslash n''}}}}\kern.5\wd0~amongst all jobs.};
      \node[below right,yshift=2mm,xshift=3.5mm,T] at(@n.south west) {No longer guarantees order.};
      % TODO: note that order is unimportant in this example
      % TODO: uss exactly the jobs given
      % TODO: note records default to one line (--recstart "" --recend "\n") can be used to label different records
      %       whatever given decides where to split; Flo: es verbiete nicht beide, aber ich weiß nicht, was es dann tut ich
   }
   \onslide<6->{\draw[T,-Kite] ([yshift=.25mm,xshift=.15mm]yarn@) to[out=0,in=180] ++(.65,-.5) node[right,yshift=-.42mm] {Runs \T{tsc \&\& node consumer.js}};}
   % TODO: note that we use that only for typescript and package version management
   \onslide<7->{\node[above right,xshift=\beamer@leftmargin,yshift=1cm,font=\tiny\ttfamily,text width=14cm] (@) at(current page.south west) {\begin{tabular}{rrrl}
      {pid} & {ppid} & {cpuid} & {cmd} \\ % {lwp} & \rlap{\quad\ldots}
\midrule
 258484 & \M{258481} &  3 & \MM{\bbash{/bin/bash -c java -jar producer.jar 1000000 | parallel --pipe}\textcolor{gray}{\,[\ldots]\!}\bbash{| yarn --silent start-consumer}} \\
 \M{\Q{258485}} & \Q{258484} & \Q{2} & \Q{\K{\bbash{java -jar producer.jar 1000000}}} \\
 \Q{258486} & \Q{258484} & \Q{9} & \Q{\K{\bbash{/usr/bin/perl /usr/bin/parallel --pipe --roundrobin -j4 java -jar consumer.jar}}} \\
 \Q{258487} & \Q{258484} & \Q{3} & \Q{\MM{node /home/lord-waddle/.nvm/versions/no:c:de/v16.15.1/bin/yarn --silent start-consumer}} \\
 \M{\Q{258519}} & \Q{258486} & \Q{11} & \Q{\K{\bbash{java -jar consumer.jar}}} \\
 \M{\Q{258520}} & \Q{258486} & \Q{ 3} & \Q{\K{\bbash{java -jar consumer.jar}}} \\
 \M{\Q{258522}} & \Q{258486} & \Q{ 7} & \Q{\K{\bbash{java -jar consumer.jar}}} \\
 \M{\Q{258524}} & \Q{258486} & \Q{10} & \Q{\K{\bbash{java -jar consumer.jar}}} \\
 \Q{258604} & \Q{258487} & \Q{11} & \Q{\K{\bbash{/bin/sh -c tsc \&\& node consumer.js}}} \\
 \M{\Q{258605}} & \Q{258604} & \Q{ 4} & \Q{\K{\bbash{/home/lord-waddle/.nvm/versions/no:c:de/v16.15.1/bin/node consumer.js}}}\\
 \M{\Q{258618}} & \M{\Q{258480}} & \Q{11} & \Q{\MM{\bbash{ps -o pid,ppid,cpuid,cmd}}}
   \end{tabular}};
   }
\only<0|handout:1>{%
   % tikzmark is problematic due to nested tikz and me being lzy
   \draw[-Kite,T] ([xshift=-.85cm,yshift=-1.65cm]@2.north) to[out=0,in=180] ++(.5,-.15) node[right,xshift=.25ex,align=left] {Much simpler (reuses workers for records)};
   \draw[-Kite,T] ([xshift=.45cm,yshift=-2.5cm]@2.north) to[bend left] ++(.5,.25) node[right,xshift=.25ex,align=left,yshift=-.25mm] {Compilation (\T{tsc}) already completed};
 % TODO: note, compile process has already ended here, others would be there just the same (say that pipes buffer)
}
   \onslide<9->{\node[below right,T,xshift=-3mm,align=left,yshift=-.25mm,scale=.5] at ([yshift=-2.65cm]@2.north)  {Path on Florian's system};}
\end{tikzpicture}
\end{frame}
}

\subsection{Data Encoding}
\SidebarCite{breg2003java}
\SidebarRaw{\link{https://docs.oracle.com/en/java/javase/17/docs/specs/rmi/index.html}{{\faExternalLink}~Java RMI~[07/01/22]}}
\SidebarRaw{\link{https://github.com/google/gson}{{\faExternalLink}~google/gson~[07/01/22]}}
\begin{frame}[fragile]{Data Encoding}
   \begin{itemize}[<+(1)->]
      \itemsep12pt
      \item Pipes can be used to pass any data (plain text, binary,~\ldots)
      \item For example, we can use \textsc{json} to encode objects
      \item In Java, we can use Gson \begin{itemize}
         \itemsep2pt
         \item Serialization with \bjava{gson.toJson(obj)}
         \item Deserialization with \bjava{gson.fromJson(input, :lan:Class:ran:)}
         \item Common (de-)serialization problems (cf. \solGet{keywordC}{MarshalException} with Java RMI) % e.g. objects that can not be serialized % CCPDP F => Distributed
      \end{itemize}
      % TODO:
      % \item However, pipes differ from networks \begin{itemize}
      %    \itemsep2pt
      %    \item Pipes are by default one-directional
      %    \item Connecting one input with one output (cf. GNU \LogoParallel)
      % \end{itemize}
   \end{itemize}
   % TODO: code-example here (live)
   % TODO: talk about missing standardization (like with grpc proto buffers)
   % objekte % FLORIAN (gson und so)
\end{frame}
\SidebarReset
}

\subsection{Recap} % maybe not as separate bot in the bottom?
\SidebarRaw{\link{https://grpc.io/}{{\faExternalLink}~gRPC~[07/01/22]}}
\SidebarRaw{\link{https://developers.google.com/protocol-buffers/}{{\faExternalLink}~protocol buffers~[07/01/22]}}
\begin{frame}{Recap}
   \begin{itemize}[<+(1)->]
      \itemsep12pt
      \item Stream-based communication \begin{itemize}
         \item Cf. Javas functional streams
         \item Serialization and deserialization % TODO: talk about advantages and disadvantages
         \item Decoupled programs (e.g., no shared memory)
      \end{itemize}
      \item Allows distribution individual operators in the pipeline
      \item Easy combination of different languages \begin{itemize}
         \item Comparable with gRPC
         \item But: no message standardization (cf. protocol buffers)
         % TODO: note advantage: no setup required, but far more complex and error-prone in large systems and pipelines
      \end{itemize}
      \item Programs don't know anything of the parallelization
   \end{itemize}
\end{frame}
\SidebarReset

\section{Inner Workings}
\subsection{Bash Pipelines}
% TOOD: siebar note for bash only  | https://www.gnu.org/software/bash/manual/bash.pdf
%
\SidebarRaw{\link{https://pubs.opengroup.org/onlinepubs/9699919799/functions/pipe.html}{{\faExternalLink}~posix/pipe~[07/01/22]}}
\SidebarRaw{\link{https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3\_chap02.html\#tag\_18\_09\_02}{{\faExternalLink}~unix pipeline~[07/01/22]}}
\SidebarRaw{\link{https://devdocs.io/bash/pipelines}{{\faExternalLink}~bash pipelines~[07/01/22]}}
\SidebarRaw{\link{https://vivadifferences.com/difference-between-pipe-and-fifo-inter-process-communication/}{{\faExternalLink}~named pipes~[07/01/22]}}
% https://unix.stackexchange.com/questions/353728/can-i-increase-the-system-pipe-buffer-max
% https://stackoverflow.com/questions/51452321/how-does-buffer-in-bash-pipe-work-on-linux
\begin{frame}{About Pipelines\rhead{bash}} % and friends
\begin{itemize}[<+(1)->]
   \itemsep10pt
   \item Executes each program in own subshell% TODO: allgemein Unix: parallel
   \item Buffer provided by the kernel \begin{itemize}
      \itemsep1.5pt
      \item Works on bytes (no known boundaries except max-size)
      \item Limited capacity (\T{\link{https://www.man7.org/linux/man-pages/man7/pipe.7.html}{/proc/sys/fs/pipe-max-size}})
      \item By default blocking read and write
      \item Can be changed with \T{\link{https://www.man7.org/linux/man-pages/man7/pipe.7.html}{O{\raisebox{1pt}{\_}}NONBLOCK}} flag (\T{\link{https://www.man7.org/linux/man-pages/man2/pipe.2.html}{pipe2}}, \T{\link{https://www.man7.org/linux/man-pages/man2/fcntl.2.html}{fnctl}})
      \item This sets \T{errno} to \T{EWOULDBLOCK} or \T{EAGAIN}
   \end{itemize}
   \item By default unidirectional \begin{itemize}
      \item Named pipes (like \T{\link{https://man7.org/linux/man-pages/man7/fifo.7.html}{fifo}}) allow half duplex data flow
   \end{itemize}
   % TODO: talk about Additionaly they can be combined with redirections
\end{itemize}
\end{frame}
\SidebarReset

\subsection{GNU Parallel}
\SidebarRaw{\link{https://www.gnu.org/software/parallel/parallel\_design.pdf}{{\faExternalLink}~parallel design~[07/01/22]}}
\SidebarRaw{\link{https://catern.com/posts/pipes.html}{{\faExternalLink}~unbuffered output~[07/01/22]}}
\begin{frame}{GNU Parallel}
   \begin{itemize}[<+(1)->]
      \itemsep8pt
      \item Mixes tabs and spaces for padding~\smash{\raisebox{-2pt}{\resizebox*!{\baselineskip}{\tikz\pingu[wings shock,eyes shock,tie=pingu@black,body type=chubby];}}}
      \item Supplied as a single file (object-oriented Perl)% TODO: why perl? Ole Tange says it appeared to be everywhere and can therefore run without a compiler uses rather old constructs for backwards compatibility
      \begin{itemize}
         \item Runs wherever there is a Perl interpreter
         \item Rather slow, 3--10\,\unit{\milli\second} per job and \qty{1}{\milli\second\per\mega\byte} output % NOTE: minimum
         \item Uses busy wait (with exponential sleeping times)% NOTE: up to one second
         \item A lot of support for the hosting shell % TODO: NOTE: custom envs for a lot of shells env_parallel.{zsh,csh,fish,...}
      \end{itemize}
   \item Buffers output on disk for distinction
   \item GNU \LogoParallel parses processes everything from stdin \begin{itemize}
      \item E.g., this limits the throughput of \T{-{}-pipe}
   \end{itemize} % TODO: note max out at 1Gbs in 100Mbs out
   \end{itemize}
\end{frame}
\SidebarReset

\section{Outlook}
\SidebarRaw{\link{https://www.gnu.org/software/parallel/parallel\_tutorial.html\#semaphore}{{\faExternalLink}~parallel tutorial~[06/30/22]}}
\SidebarRaw{\link{https://www.gnu.org/software/parallel/parallel_alternatives.pdf}{{\faExternalLink}~parallel alternatives~[06/30/22]}}
\begin{frame}{It can do more!}
\begin{itemize}[<+(1)->]
   \itemsep4pt
   \item Different spreading strategies (\T{-{}-shard}, \T{-{}-bin},~\ldots) for \T{-{}-pipe}
   \item Replacement strings (\T{\{\}}, \T{\{\%\}},~\ldots)% {= <perl> =}
   \item Compression of buffer data (\T{-{}-compress}) % TODO: other problem with tempfiels
   \item Comfort-Support for named pipes (\T{-{}-fifo})
   \item Support for unfair counting semaphore with timeout \begin{itemize}
      \item With options (\T{-{}-semaphore})
      \item As alternative Program (\T{sem})
   \end{itemize}
   \item Load Balancing (\T{-{-}limit}, \T{-{}-load},~\ldots)
   \item And so much more (Tables, SQL, Shebang,~\ldots) % TODO: NOTE Eierlegende wollmilchsau entgegen der ursprünglichen toolbox idee
\end{itemize}
% todo: unitprefix stuff
% FELIX&FLO
% praktische Anwendungen
% gibt es eine geplante Weiterentwicklung? <- joa (design ganz unten)
% Alternativen: https://www.gnu.org/software/parallel/parallel_alternatives.pdf
% xargs hat -P, makefiles etc.
% -pipe vs pipepart, disk buffering
% sql support --sql-master etc.
% table support
% shebang
% -N for max args etc
\end{frame}
\SidebarReset
% TODO: note perls open3 (https://perldoc.perl.org/IPC::Open3) which GNU parallel uses is slow
% TODO: nur wenn wir noch zeit haben, sonst erwähnen
% \SidebarRaw{\link{https://www.gnu.org/software/parallel/parallel_alternatives.pdf}{{\faExternalLink}~parallel alternatives~[06/30/22]}}
% \begin{frame}{Alternatives}% and Future Plans} future plans are there, but technical
%    \begin{itemize}[<+(1)->]
%       \item \T{xargs}
%    \end{itemize}
% \end{frame}
% \SidebarReset
\end{document}